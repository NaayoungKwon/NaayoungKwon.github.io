---
date: 2023-08-24
title: "3장 단위 테스트 구조"
tags: [AAA패턴, 테스트픽스처, 리팩토링, ]
categories:
  - Unit Test
excerpt: AAA패턴,테스트픽스처,리팩토링

permalink: /unit-test/3장-단위-테스트-구조/

toc: true
toc_sticky: true
---


## 단위 테스트를 구성하는 방법


### AAA 패턴 사용


![0](/assets/img/2023-08-24-3장-단위-테스트-구조.md/0.png)

- AAA 패턴은 각 테스트를 준비, 실행, 검증이라는 세 부분으로 나눌 수 있다.
	- 준비 구절 : SUT와 해당 의존성을 원하는 상태로 만든다.
	- 실행 구절 : SUT에서 메서드를 호출하고 준비된 의존성을 전달하며 출력 값을 캡처한다.
	- 검증 구절 : 결과를 검증한다.
- Given-When-Then 패턴은 테스트 구성 측면에서 AAA와 차이가 없다.

### 유의사항

- 여러 개의 준비, 실행, 검증 구절 피하기
- 테스트 내 if 문 피하기 → 안티 패턴
- 준비 구절이 너무 큰 경우 테스트 클래스 내 비공개 메서드 또는 별도의 팩토리 클래스로 도출하자
- 실행 구절이 한 줄 이상인 경우 경계할 것
- 단일 동작 단위는 여러 결과를 낼 수 있으며, 하나의 테스트로 그 모든 결과를 평가하는 것이 좋다.
- SUT를 의존성과 구분하는 것이 중요하다. (테스트 내 SUT 이름을 sut로 하기)
- AAA 패턴을 따른다면 (준비/실행/검증) 주석을 지우고 빈 줄로 분리하라

## 테스트 간 테스트 픽스처 재사용


> **테스트 픽스처 :** SUT를 실행하기 위해 해줘야 하는 모든 것


테스트 픽스처를 준비하기 위해 코드를 너무 많이 작성해야한다.


준비 구절에서 코드를 재사용하는 것이 테스트를 줄이면서 단순화하기 좋은 방법이다.


![1](/assets/img/2023-08-24-3장-단위-테스트-구조.md/1.png)_https://github.com/woowacourse/service-apply/blob/master/src/test/kotlin/apply/JudgmentFixtures.kt_


![2](/assets/img/2023-08-24-3장-단위-테스트-구조.md/2.png)


### 유의사항

- 테스트 간의 높은 결합도는 안티 패턴이다.
- 생성자 사용은 테스트 가독성을 떨어트린다.
	- 테스트만 보고는 더 이상 전체 그림을 볼 수 없다.

[bookmark](https://jojoldu.tistory.com/611)


### 재사용법

- 테스트 클래스에 private factory method를 둔다.
	- 앞에 명시함으로서 읽기 쉽고 재사용이 가능하다.
- 테스트 전부 또는 대부분에 사용되는 생성자에 픽스처를 인스턴스화할 수 있다.
	- ex. 데이터베이스 연결

## 단위 테스트 명명 및 리팩토링


### 명명법

- 올바른 명칭은 테스트가 검증하는 내용과 기본 시스템의 동작을 이해하는데 도움이 된다.
- 간단하고 쉬운 영어 구문이 효과적이다.
- 엄격한 명명 정책을 따르기보다는 시나리오를 설명하는 것 처럼 이름을 짓자.
- 단어를 _ 표시로 구분한다.
- 테스트 이름에 SUT의 메서드 이름을 포함하지 말라.

[bookmark](https://it-is-mine.tistory.com/3)


### 리팩토링

- 매개변수화된 테스트를 사용해 유사한 테스트를 묶자
- 매개 변수만으로 테스트 케이스를 판단할 수 있으면 긍정적인 TC와 부정적인 TC를 하나의 메서드로 두는 것이 좋다.
- 동작이 복잡하면 테스트를 분리하자.

### 검증문 라이브러리 사용

- 검증문 라이브러리를 사용하면, 쉬운 영어처럼 읽도록 검증문에서 단어 순서를 재구성해 테스트 가독성을 더욱 향상시킬 수 있다.
