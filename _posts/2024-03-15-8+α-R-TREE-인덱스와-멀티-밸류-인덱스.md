---
date: 2024-03-15
title: "8+α R-TREE 인덱스와 멀티 밸류 인덱스"
tags: [공간 인덱스, R-TREE, 멀티 밸류 인덱스, ]
categories:
  - Real MySQL
excerpt: 공간 인덱스,R-TREE,멀티 밸류 인덱스

permalink: /real-mysql/8+α-R-TREE-인덱스와-멀티-밸류-인덱스/

toc: true
toc_sticky: true
---


Real MySQL 8.0을 읽다가 완전 처음 들어보는 인덱스 내용이 나왔다.


신기해서 이 부분은 따로 정리했다.


## R-TREE 인덱스


### R-TREE 인덱스란

- 공간 인덱스는 R-Tree 인덱스 알고리즘을 이용해 2차원의 데이터를 인덱싱하고 검색하는 목적의 인덱스다.
- 기본적인 내부 매커니즘은 B-TREE와 흡사하다.
	- 인덱스를 구성하는 칼럼의 값이 1차원 스칼라 값 → 2차원 공간 개념 값
- 위치 기반의 서비스를 MySQL의 공간 확장을 이용하면 간단하게 구현할 수 있다.
- MySQL 공간 확장의 3가지 기능
	- 공간 데이터를 저장할 수 있는 데이터 타입
	- 공간 데이터의 검색을 위한 공간 인덱스
	- 공간 데이터의 연산 함수(거리 또는 포함관계의 처리)

### 구조 및 특성

- 공간 정보의 저장 및 검색을 위해 여러가지 기하학적 도형 정보를 관리할 수 있는 데이터 타입을 제공한다.

	![0](/assets/img/2024-03-15-8+α-R-TREE-인덱스와-멀티-밸류-인덱스.md/0.png)

- MBR
	- Minimum Bounding Rectangle의 약자
	- 도형을 감싸는 최소 크기의 사각형을 의미한다.

		![1](/assets/img/2024-03-15-8+α-R-TREE-인덱스와-멀티-밸류-인덱스.md/1.png)

	- 이 사각형들의 포함 관계를 B-Tree 형태로 구현한 인덱스가 R-Tree
	- MBR을 3개의 레벨로 나눠서 그린 그림

		![2](/assets/img/2024-03-15-8+α-R-TREE-인덱스와-멀티-밸류-인덱스.md/2.png)

		- 최상위 MBR은 R-TREE의 루트 노드에 저장되는 정보
		- 차상위 그룹 MBR은 R-TREE 브랜치 노드
		- 각 도형의 객체는 리프 노드에 저장
- R- Tree 인덱스의 내부

	![3](/assets/img/2024-03-15-8+α-R-TREE-인덱스와-멀티-밸류-인덱스.md/3.png)


### R-Tree 인덱스의 용도

- Rectangle의 R과 B-TREE의 Tree를 섞어서 R-Tree라는 이름이 붙여졌다.
- 공간 인덱스라고도 한다.
- GPS 기준의 위도, 경도 좌표 저장에 주로 사용된다.
- 좌표 시스템에 기반을 둔 정보에 대해서는 모두 적용할 수 있다.
- 각 도형의 포함 관계를 비교하는 함수로 검색을 수행하는 경우에만 인덱스를 이용할 수 있다.
	- ex. 현재 위치로부터 반경 5km 이내

![4](/assets/img/2024-03-15-8+α-R-TREE-인덱스와-멀티-밸류-인덱스.md/4.png)

- P가 기준점
- 기준점으로 부터 반경 거리 5km이내 점을 검색하기 위해 우선 사각 점섬의 상자에 포함되는 점들을 검색하면 된다.
- 최소 사각형(MBR)로 포함 관계 비교를 수행한다.
- P6은 5km 이상이지만 최소 사각형 내에는 포함된다
	- 결과를 포함해도 된다면 ST_Contains()나 ST_Within() 비교만 수행하는 것이 좋다.

## 멀티 밸류 인덱스

- 전문 검색 인덱스를 제외한 모든 인덱스는 레코드 1건이 1개의 인덱스 키 값을 가진다.
- Multi-Value 인덱스는 하나의 데이터 레코드가 여러 개의 키 값을 가질 수 있는 형태의 인덱스다.
- 일반적인 RDBMS를 기준으로 생각하면 이러한 인덱스는 정규화에 위배되는 형태다.
- RDBMS가 JSON 데이터 타입을 지원하기 시작하면서 JSON의 배열 타입의 필드에 저장된 원소들에 대한 인덱스 요건이 발생하며 나왔다.
- 멀티 밸류 인덱스를 활용하기 위해서는 일반적인 조건 방식을 사용하면 안되고, 주어진 함수를 이용해 검색해야 옵티마이저가 인덱스를 활용한 실행 계획을 수립한다.
	- MEMBER_OF()
	- JSON_CONTAINS()
	- JSON_OVERLAPS()
{% raw %}
```sql
> selet * from user where 360 member_of(credit_info->'$.credit_scores');
```
{% endraw %}

- 스터디 현업 예시
	- 외부 요청 전문을 저장하는 경우
