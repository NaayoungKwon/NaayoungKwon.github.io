---
date: 2023-09-13
title: ""
tags: [단위테스트 스타일, 출력 기반 테스트, 상태 기반 테스트, 통신 기반 테스트, 함수형 아키텍처, ]
categories:
  - unit-test
excerpt: 단위테스트 스타일,출력 기반 테스트,상태 기반 테스트,통신 기반 테스트,함수형 아키텍처

permalink: /unit-test//

toc: true
toc_sticky: true
---


## 단위 테스트의 스타일

- 출력 / 상태 / 통신 기반 테스트
- 스타일과 단위 테스트 분파
	- 고전파는 통신 기반 보다 상태 기반 스타일을 선호한다.
	- 런던파는 선택한다.
	- 두 분파는 출력 기반 테스트를 사용한다.

### 출력 기반 테스트

- 테스트 대상 시스템(SUT)에 입력을 넣고 생성되는 출력을 점검하는 방식
- 전역 상태나 내부 상태를 변경하지 않는 코드에만 적용되어 반환 값만 검증하면 된다.
- 함수형 이라고도 한다.

![0](/assets/img/2023-09-13-.md/0.png)


### 상태 기반 테스트

- 작업이 완료된 후 시스템 상태를 확인

![1](/assets/img/2023-09-13-.md/1.png)


### 통신 기반 테스트

- 목을 사용해 테스트 대상 시스템과 협력자 간의 통신을 검증한다.
- SUT의 협력자를 목으로 대체하고 SUT가 협력자를 올바르게 호출하는지 검증한다.

![2](/assets/img/2023-09-13-.md/2.png)


## 단위 테스트의 스타일 비교


항상 다른 것 보다 출력 기반 테스트를 선호하라.


### 회귀 방지와 피드백 속도 지표

- 회귀 방지 지표 : 특정 스타일에 따라 달라지지 않는다.
- 피드백 속도 지표 : 상관관계가 거의 없다. 테스트가 외부 의존성과 떨어진 단위 테스트 영역에 있는 한, 모든 스타일은 테스트 실행 속도가 거의 동일

### 리팩터링 내성 지표


> 캡슐화를 잘 지키고 테스트를 식별할 수 있는 동작에만 결합하면 거짓 양성을 최소로 줄일 수 있다.

- 출력 기반 테스트
	- 테스트가 테스트 대상 메서드에만 결합 하므로 거짓 양성 방지가 우수하다.
- 상태 기반 테스트
	- 거짓 양성이 되기 쉽다.
	- 테스트 대상 메서드 외에도 클래스 상태와 함께 작동한다.
	- 큰 API 노출 영역에 의존하므로, 구현 세부 사항과 결합할 가능성도 높다.
- 통신 기반 테스트
	- 허위 경보에 가장 취약하다.
	- 테스트 대역으로 상호 작용을 확인하는 테스트는 깨지기 쉽다.

### 유지 보수성 지표


> 단위 테스트 스타일과 밀접한 관련이 있으나 완화할 수 있는 방법이 많지 않다.

- 단위 테스트 유지비 측정 특성
	- 테스트 크기에 대한 함수
	- 테스트가 직접적으로 관련 있는 프로세스 외부 의존성 개수에 대한 함수
- 출력 기반 테스트
	- **가장 유지 보수하기 용이**하다.
- 상태 기반 테스트
	- 일반적으로 출력 기반 보다 유지 보수가 쉽지 않다.
	- 상태 검증이 종종 출력 검증보다 더 많은 공간을 차지한다.
- 통신 기반 테스트
	- 점수가 가장 낮다.
	- 테스트 대역과 상호 작용 검증을 설정하면서 공간을 많이 차지한다.

## 함수형 아키텍처

- 함수형 프로그래밍
	- 숨은 입출력이 없는 함수
	- 호출 횟수에 상관없이 주어진 입력에 대해 동일한 출력을 생성
	- 출력 기반 테스트를 적용할 수 있는 메서드는 수학적 함수 뿐이다.
	- 숨은 입출력은 코드를 테스트하기 힘들게 한다.
		- 사이드 이펙트 : 메서드에 표시되지 않은 출력
		- 예외 : 메서드에 설정된 계약을 우회하는 경로를 만든다.
		- 내외부 상태에 대한 참조 : DateTime.now 와 같은 정적 속성을 사용해 현재 시간을 가져오는 메서드가 있을 수 있다.
- 함수형 아키텍처

	![3](/assets/img/2023-09-13-.md/3.png)

	- 비지니스 로직을 처리하는 코드와 사이드 이펙트를 일으키는 코드를 분리
	- 함수형 코어 : 결정을 내리는 코드. 사이드 이펙트가 없음
	- 가변 셀 : 해당 결정에 따라 작용하는 코드. 수학적 함수에 의해 의뤄진 결정을 DB의 변경이나 메시지 버스로 전송된 메시지 같이 가시적인 부분으로 전환
	- 함수형 코어와 가변 셀의 협력 방식
		- 가변 셀을 모든 입력을 수집한다.
		- 함수형 코어는 결정을 생성한다.
		- 셀은 결정을 사이드 이펙트로 변환한다.

### 함수형과 육각형 아키텍처

- 함수형 아키텍처와 육각형 아키텍처는 비슷한 점이 많다.
	- 관심사의 분리, 의존성 간의 단방향 흐름
- 차이점은 사이드 이펙트에 대한 처리에 있다.
	- 함수형 : 모든 사이드 이펙트를 불변 코어에서 비지니스 연산 가장자리로 밀어냄
	- 육각형 : **모든 수정 사항은 도메인 계층 내 있어야 하며**, 계층의 경계를 넘어서는 안된다.

### 함수형 아키텍처와 출력 기반 테스트

- 테스트를 파일 시스템에서 분리하기 위한 목 사용

	![4](/assets/img/2023-09-13-.md/4.png)


![5](/assets/img/2023-09-13-.md/5.png)


### 단점

- 항상 함수형 아키텍처를 이룰 수 있는 것은 아니다.
- 프로세스 외부 의존성을 더 많이 호출하고 그 결과 성능이 떨어졌다.
- 함수형 코어와 가변 셀 사이를 명확히 분리하면서 코드 복잡도는 낮아지고 유지 보수성이 향상되지만, 초기에 코딩이 더 필요하다.
- 함수형 방식에서 순수성에 많은 비용이 든다면 순수성을 따르지 말라.
