---
date: 2023-08-30
title: "4장- 좋은 단위 테스트의 4대 요소"
tags: [좋은테스트, 회귀 방지, 리팩터링 내성, 빠른 피드백, 유지 보수성, 거짓 양성, 거짓 음성, 블랙박스 테스트, ]
categories:
  - unit-test
excerpt: 좋은테스트,회귀 방지,리팩터링 내성,빠른 피드백,유지 보수성,거짓 양성,거짓 음성,블랙박스 테스트

permalink: /unit-test/4장--좋은-단위-테스트의-4대-요소/

toc: true
toc_sticky: true
---


> 📌 좋은 단위 테스트의 4대 요소  
> 회귀 방지 / 리팩터링 내성 / 빠른 피드백 / 유지 보수성


## 회귀 방지와 리팩터링 내성


### 회귀 방지

- 회귀 : 소프트웨어 버그
- 회귀에 대해 효과적인 보호를 개발하는 것이 중요하다.
- 실행되는 코드가 많을수록 테스트에서 회귀가 나타날 가능성이 높다.
- 코드의 양 뿐만아니라 복잡도와 도메인 유의성도 중요하다.

### 리팩토링 내성

- 테스트를 실패로 바꾸지 않고 코드를 리팩토링할 수 있는지에 대한 척도이다.
- 리팩터링 내성 지표에서 테스트 점수가 얼마나 잘 나오는지 평가하려면 테스트에서 얼마나 많이 거짓 양성이 발생하는지 살펴봐야한다.
	- 거짓 양성 : 기능은 의도대로 작동하나 테스트는 실패를 나타내는 것
	- 테스트가 타당한 이유 없이 실패하면, 코드 문제에 대응하는 능력과 의지가 희석된다.
	- 거짓 양성이 빈번하면 테스트에 대한 신뢰가 떨어지며, 신뢰가 부족해지면 리팩터링이 줄어든다.

### 구현 세부 사항 대신 최종 결과를 목표로 하기

- 리팩터링 내성을 높이는 방법은 SUT의 구현 세부 사항과 테스트 간의 결합도를 낮추는 것 뿐이다.
- 코드 내부 작업과 테스트 사이를 가능한 멀리 떨어뜨리고 최종 결과를 목표로 하는 것이다.
- 왼쪽 그림이 SUT의 식별할 수 있는 동작과 결합된 테스트 → 거짓 양성이 거의 발생하지 않는다.

![0](/assets/img/2023-08-30-4장--좋은-단위-테스트의-4대-요소.md/0.png)


### 회귀 방지 <> 리팩터링 내성 간의 본질적인 관계


![1](/assets/img/2023-08-30-4장--좋은-단위-테스트의-4대-요소.md/1.png)

- 회귀 방지가 훌륭한 테스트는 거짓 음성의 수를 최소화하는데 도움이 된다.
- 거짓 양성을 피하는데 리팩터링 내성이 도움이 된다.

![2](/assets/img/2023-08-30-4장--좋은-단위-테스트의-4대-요소.md/2.png)

- 두 특성은 시간이 흐르면서 프로젝트에 영향을 다르게 미친다.
- 거짓 양성은 초기에 그다지 부정적인 영향을 미치지 않는다. 그러나 프로젝트에 거짓 음성이 중요한 만큼 거짓 양성도 점점 더 중요해진다.
- 대부분 회귀 방지에만 중점을 두는 경향이 있는데, 중대형 프로젝트에서 작업하면, 거짓 음성과 거짓 양성에 대해 똑같이 주의를 기울여야한다.

## 빠른 피드백과 유지 보수성

- 빠른 피드백은 단위 테스트의 필수 속성이다.
- 유지 보수성 지표는 유지비를 평가한다.
	- 테스트가 얼마나 **이해**하기 어려운가 (코드 라인), 테스트 코드를 일급 시민으로 취급하라
		- **1급 시민의 조건 3가지**

			1. 변수나 데이타에 할당 할 수 있어야 한다.


			2. 객체의 인자로 넘길 수 있어야 한다.


			3. 객체의 리턴값으로 리턴 할수 있어야 한다.

	- 테스트가 얼마나 **실행**하기 어려운가 (외부 종속성)

## 이상적인 테스트

- 이상적인 테스트를 만드는 것은 불가능하다.
- 회귀 방지 / 리팩터링 내성 / 빠른 피드백은 상호 배타적이기 때문이다.
- 셋 중 하나를 희생해야 나머지 둘을 최대로 할 수 있다.
- 균형을 이뤄내는 것은 쉽지 않으며 조금씩 인정하는 것이 최선의 전략이다.

![3](/assets/img/2023-08-30-4장--좋은-단위-테스트의-4대-요소.md/3.png)

- 실제로는 리팩터링 내성을 포기할 수 없고, 회귀 방지와 빠른 피드백 사이의 선택으로 절충이 귀결된다.
- 리팩터링은 내성이 있거나 없거나 둘 중 하나다.

![4](/assets/img/2023-08-30-4장--좋은-단위-테스트의-4대-요소.md/4.png)


### 엔드 투 엔드 테스트

- 최종 사용자의 관점에서 시스템을 살펴본다.
- 모든 시스템 구성 요소를 거치게 된다.
- 많은 코드를 테스트하므로 회귀 방지를 훌륭히 해낸다.
- 리팩터링은 식별할 수 있는 동작을 변경하지 않으므로 이 테스트에 영향을 미치지 않는다.
- 큰 단점은 느린 속도다.

### 간단한 테스트
{% raw %}

```java
@Getter
@Setter
public class User{
	String name;
}

public void Test(){
	var sut = new User();
	ust.getName() == "Join Smith";
}
```
{% endraw %}

- 항상 통과하거나 검증이 무의미 하기 때문에 어떤 것도 테스트한다고 볼 수 없다.

### 깨지기 쉬운 테스트

- 회귀를 잡을 가능성이 높지만 거짓 양성이 많은 테스트
- 테스트가 SUT의 내부 구현 세부 사항에 결합되는 예.

## 대중적인 테스트 자동화 개념  살펴보기


### 테스트 피라미드 분해


![5](/assets/img/2023-08-30-4장--좋은-단위-테스트의-4대-요소.md/5.png)

- 테스트 피라미드 : 테스트 유형 간의 일정한 비율
- 상단의 테스트는 회귀 방지에 유리한 반면, 하단은 실행 속도를 강조한다.
- 어느 계층도 리팩토링 내성을 포기하지 않는다.
- 테스트는 거짓 양성을 가능 한 적게 하는 것을 목표로 해야한다.
- 비지니스 규칙이나 복잡도가 거의 없는 기본적인 CRUD라면 단위 테스트, 통합 테스트 수가 같고 엔드 투 앤드 테스트가 없는 직사각형 처럼 보일 것이다.
- 외부 의존성 (DB) 하나만 연결하는 경우 e2e를 더 많이 두는 것이 적합한 옵션일 수 있다.

### 블랙박스 테스트와 화이트 박스 테스트 간의 선택

- 블랙박스 테스트
	- 시스템의 내부 구조를 몰라도 시스템의 기능을 검사할 수 있는 소프트웨어 테스트 방법
	- 명세와 요구 사항을 중심으로 구축된다.
- 화이트 박스 테스트
	- 내부 작업을 검증하는 방식으로 소스 코드에서 파생된다.
	- 많은 오류를 발견할 수 있지만, 특정 구현에 결합돼 있어 깨지기 쉽다.
- 테스트는 리팩터링 내성이 있거나 아예 없기 때문에 화이트박스 대신 블랙박스 테스트를 기본으로 선택하라

|           | 회귀 방지 | 리팩터링 내성 |
| --------- | ----- | ------- |
| 화이트박스 테스트 | 좋음    | 나쁨      |
| 블랙박스 테스트  | 나쁨    | 좋음      |

undefined