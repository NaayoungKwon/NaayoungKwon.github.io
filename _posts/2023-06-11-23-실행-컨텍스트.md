---
date: 2023-06-11
title: "23 실행 컨텍스트"
categories:
  - Modern JavaScript

permalink: /modern-javascript/23-실행-컨텍스트/

toc: true
toc_sticky: true
---


## 소스코드


### 소스코드 타입


> 소스코드의 타입에 따라 실행 컨텍스트를 생성하는 과정과 관리 내용이 다르다.

- 전역 코드
	- 전역에 존재하는 소스코드
	- 최상위 스코프인 전역 스코프를 생성해야한다.
	- `var` 로 선언된 전역 변수와 함수 선언문으로 정의된 전역 함수를 전역 객체의 프로퍼티와 메서드로 바인딩하고 참조를 위해 전역 객체와 연결
- 함수 코드
	- 함수 내부에 존재하는 소스코드
	- 지역스코프를 생성하고 전역 스코프에서 시작하는 스코프 체인의 일원으로 연결해야한다.
	- 지역 변수, 매개변수, arguments 객체를 관리해야한다.
- eval 코드
	- 빌트인 전역 함수인 eval 함수에 인수로 전달되어 실행되는 소스코드
- 모듈 코드
	- 모듈 내부에 존재하는 소스코드

### 소스코드의 평가와 실행


자바스크립트 엔진은 소스코드의 평가와 실행 과정으로 나누어 처리한다.


![0](/assets/img/2023-06-11-23-실행-컨텍스트.md/0.png)


## 실행 컨텍스트


> 실행 컨텍스트는 소스코드를 실행하는 데 필요한 환경을 제공하고 코드의 실행 결과를 실제로 관리하는 영역이다.


### 실행 컨텍스트란

- 식별자(변수, 함수, 클래스 등의 이름)를 등록하고 관리하는 스코프와 코드 실행 순서 관리를 구현한 내부 매커니즘으로, 모든 코드는 실행 컨텍스트를 통해 실행되고 관리된다.
- 식별자와 스코프는 실행 컨텍스트의 `렉시컬 환경`으로 관리하고 코드 실행 순서는 `실행 컨텍스트 스택`으로 관리한다.

### 실행 컨텍스트의 역할

1. 전역 코드 평가
	- 전역 코드의 변수 선언문과 함수 선언문이 먼저 실행
	- 그 결과 생성된 전역 변수와 전역 함수가 실행 컨텍스트가 관리하는 전역 스코프에 등록된다.
2. 전역 코드 실행
	- 전역 코드가 순차적으로 실행되기 시작한다.
3. 함수 코드 평가
	- 함수가 호출되면 함수 내부의 문들을 실행하기에 앞서 함수 코드 평가 과정을 거친다.
	- 매개 변수와 지역 변수 선언문이 먼저 실행되고, 그 결과 생성된 매개 변수와 지역 변수가 실행 컨텍스트가 관리하는 지역 스코프에 등록된다.
	- this 바인딩 결정
4. 함수 코드 실행
	- 함수 코드가 순차적으로 실행된다.

코드가 실행 되려면 스코프를 구분하여 식별자와 바인딩 된 값이 관리 되어야 한다.


중첩 관계에 의해 스코프 체인을 형성하여 식별자를 검색할 수 있어야하고, 전역 객체의 프로퍼티도 전역 변수처럼 검색할 수 있어야한다.


### 실행 컨텍스트 스택


> 코드의 실행 순서를 관리한다.


코드가 실행되는 시간의 흐름에 따라 실행 컨텍스트 스택에는 실행 컨텍스트가 추가되고 제거된다.


![1](/assets/img/2023-06-11-23-실행-컨텍스트.md/1.png)


### 렉시컬 환경


> 식별자와 식별자에 바인딩 된 값, 그리고 상위 스코프에 대한 참조를 기록하는 자료구조로 실행 컨텍스트를 구성하는 컴포넌트다.  
> **스코프와 식별자를 관리한다.**


![2](/assets/img/2023-06-11-23-실행-컨텍스트.md/2.png)

- 환경 레코드
	- 스코프에 포함된 식별자를 등록하고 등록된 식별자에 바인딩된 값을 관리하는 저장소
- 외부 렉시컬 환경에 대한 참조
	- 상위 스코프를 가리킨다.

## 실행 컨텍스트의 생성과 식별자 검색 과정


### 과정

1. 전역 객체 생성
	- 전역 코드가 평가되기 이전에 생성된다.
2. 전역 실행 컨텍스트 생성

	![3](/assets/img/2023-06-11-23-실행-컨텍스트.md/3.png)

3. 전역 렉시컬 환경 생성

	![4](/assets/img/2023-06-11-23-실행-컨텍스트.md/4.png)

	1. 전역 환경 레코드 생성
		1. 객체 환경 레코드 생성 : var로 선언한 전역 변수와 함수 선언문으로 정의한 전역 함수 관리

			![5](/assets/img/2023-06-11-23-실행-컨텍스트.md/5.png)


			> 💡 함수 선언문으로 정의한 함수가 평가되면 함수 이름과 동일한 이름의 식별자가 객체 환경 레코드에 바인딩 된 BindingObject를 통해 전역 객체에 키로 등록하고 생성된 함수 객체를 즉시 할당한다. → 함수 호이스팅과 변수 호이스팅의 차이   
			> → **함수 선언문 이전에 호출할 수 있다.**

		2. 선언적 환경 레코드 생성 : let, const 키워드로 선언한 전역 변수 관리

			![6](/assets/img/2023-06-11-23-실행-컨텍스트.md/6.png)

	2. this 바인딩

		![7](/assets/img/2023-06-11-23-실행-컨텍스트.md/7.png)

	3. 외부 렉시컬 환경에 대한 참조 결정

		![8](/assets/img/2023-06-11-23-실행-컨텍스트.md/8.png)

4. 전역 코드 실행

	![9](/assets/img/2023-06-11-23-실행-컨텍스트.md/9.png)


### 예시
{% raw %}

```javascript
var x = 1;
const y = 2;

function foo (a) { 
	var x = 3;
	const y = 4;
	function bar (b) { 
		const z = 5;
		console.log(a + b + x + y + z);
	} 
	bar(10);
}

foo(20); // 42
```
{% endraw %}


앞의 과정을 거쳐 foo 함수 실행 컨텍스트와 렉시컬 환경은 다음과 같다.


![10](/assets/img/2023-06-11-23-실행-컨텍스트.md/10.png)


### 블록 레벨 스코프

- let, const로 선언한 변수는 모든 코드 블록을 지역 스코프로 인정하는 블록 레벨 스코프를 따른다.
- 따라서 if 문을 실행하면 if 문의 코드 블록을 위한 블록 레벨 스코프를 생성해야 한다.

![11](/assets/img/2023-06-11-23-실행-컨텍스트.md/11.png)

