---
date: 2023-07-23
title: "45. 프로미스"
categories:
  - modern-javascript

permalink: /modern-javascript/45.-프로미스/

toc: true
toc_sticky: true
---


### 비동기 처리를 위한 콜백 패턴의 단점

- 비동기 함수는 비동기 처리 결과를 외부에 반환할 수 없고, 상위 스코프의 변수에 할당할 수도 없다.
- 따라서 비동기 함수의 처리 결과에 대한 후속 처리는 비동기 함수 내부에서 수행해야 한다.
- 비동기 함수를 호출해야 한다면 콜백 함수 호출이 중첩되어 복잡도가 높아지는 현상을 `콜백 헬`이라 한다.

### 프로미스 생성

- Promise 생성자 함수를 new 연산자와 함께 호출하면 프로미스를 생성한다.
- 프로미스는 현재 비동기 처리가 어떻게 진행되고 있는지를 나타내는 상태 정보를 갖는다.

	![0](/assets/img/2023-07-23-45.-프로미스.md/0.png)

- 프로미스의 상태는 resolve 또는 reject 함수를 호출하는 것으로 결정된다.

	![1](/assets/img/2023-07-23-45.-프로미스.md/1.png)

- 프로미스는 비동기 처리 상태와 처리 결과를 관리하는 객체다.

### 프로미스의 후속 처리 메서드

- 프로미스의 비동기 처리 상태가 변화하면 후속 처리 메서드에 인수로 전달한 콜백 함수가 선택적으로 호출된다.
- Promise.prototype.then
	- fulfilled 상태가 되면 호출한다.
- Promise.prototype.catch
	- reject 상태인 경우만 호출된다.
- Promise.prototype.finally
	- 성공과 실패 상관 없이 무조건 한 번 호출된다.
- 프로미스 체이닝 : then, catch, finally 후속 처리 메서드는 언제나 프로미스를 반환하므로 연속적으로 호출 할 수 있다.

### 프로미스의 정적 메서드

- Promise.All
	- 여러 개의 비동기 처리를 모두 병렬 처리할 때 사용한다.
	- 인수로 전달받은 배열의 프로미스가 하나라도 rejected 상태가 되면 나머지 프로미스를 기다리지 않고 즉시 종료한다.
- Promise.race
	- 배열 등의 이터러블을 인수로 전달받는다.
	- 가장 먼저 fulfilled 상태가 된 프로미스 처리 결과를 resolve 하는 새로운 프로미스를 반환한다.
- Promise.allSettled
	- 배열 등의 이터러블을 인수로 전달받는다.
	- 모두 settled 상태가 되면 처리 결과를 배열로 반환한다.
	- 반환하는 배열에는 모든 프로미스들의 처리 결과가 모두 담겨있다.

### 마이크로태스크 큐

- 프로미스의 후속 처리 메서드의 콜백 함수는 태스크 큐가 아니라 마이크로태스크 큐에 저장된다.
- 마이크로 태스크 큐는 태스크 큐와는 별도의 큐이다.
	- 마이크로 태스크 큐 : 프로미스의후속 처리 메서드의 콜백 함수가 저장
	- 태스크 큐 : 비동기 함수의 콜백 함수나 이벤트 핸들러
- 마이크로 태스크 큐는 태스크 큐 보다 우선순위가 높다.
